{"version":3,"sources":["../app.js"],"names":["createError","require","cors","express","path","cookieParser","logger","bodyParser","indexRouter","usersRouter","app","use","corsOptions","origin","optionsSuccessStatus","mongoose","connect","config","MLAB_DB_USERNAME","MLAB_DB_PASSWORD","useNewUrlParser","then","console","log","err","set","join","__dirname","json","urlencoded","extended","secret","resave","saveUninitialized","passport","initialize","session","serializeUser","user","done","deserializeUser","InstagramStrategy","Instagram","Strategy","clientID","INSTAGRAM_CLIENT","clientSecret","INSTAGRAM_SECRET","callbackURL","accessToken","refreshToken","profile","name","displayName","homePage","_json","data","website","image","profile_picture","bio","media","id","fullname","get","authenticate","successRedirect","failure","req","res","status","next","locals","message","error","render","module","exports"],"mappings":"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","sourcesContent":["var createError = require('http-errors');\nvar cors = require('cors')\nvar express = require('express');\nvar path = require('path');\nvar cookieParser = require('cookie-parser');\nvar logger = require('morgan');\nconst bodyParser = require('body-parser')    \n\nimport mongoose from 'mongoose'\n\nvar indexRouter = require('./routes/index');\nvar usersRouter = require('./routes/users');\n\n\nvar app = express();\napp.use(cors())\n\nvar corsOptions = {\n  origin: 'http://localhost:3000',\n  optionsSuccessStatus: 200 // some legacy browsers (IE11, various SmartTVs) choke on 204\n}\n\nmongoose.connect(`mongodb://${config.MLAB_DB_USERNAME}:${config.MLAB_DB_PASSWORD}@ds149947.mlab.com:49947/klubby`,\n  { useNewUrlParser: true })\n  .then(() => {\n    console.log('database connection was successful...')\n  })\n  .catch((err) => {\n    console.log({ err })\n  });\n\n// view engine setup\napp.set('views', path.join(__dirname, 'views'));\napp.set('view engine', 'jade');\napp.use(bodyParser.json())\n\napp.use(logger('dev'));\n//Bodyparser Middleware\napp.use(express.urlencoded({ extended: false }));\napp.use(cookieParser());\napp.use(express.static(path.join(__dirname, 'public')));\n\napp.use('/', indexRouter);\n\n// catch 404 and forward to error handler\n\n\n\n//------------------auth-----------\nimport config from './config'\nimport session from 'express-session';\nimport passport from 'passport';\nimport Instagram from 'passport-instagram';\n\napp.use(session({\n  secret: 'sytr456-65tyrd-12wrt',\n  resave: true,\n  saveUninitialized: true\n}))\n\napp.use(passport.initialize());\napp.use(passport.session());\n\npassport.serializeUser((user, done) => {\n  done(null, user)\n})\npassport.deserializeUser((user, done) => {\n  done(null, user)\n})\n\nconst InstagramStrategy = Instagram.Strategy;\npassport.use(new InstagramStrategy({\n  clientID: config.INSTAGRAM_CLIENT,\n  clientSecret: config.INSTAGRAM_SECRET,\n  callbackURL: \"http://localhost:4000/auth\"\n}, (accessToken, refreshToken, profile, done) => {\n  let user = {};\n  user.name = profile.displayName;\n  user.homePage = profile._json.data.website;\n  user.image = profile._json.data.profile_picture;\n  user.bio = profile._json.data.bio;\n  user.media = `https://api.instagram.com/v1/users/${profile.id}/media/recent/?access_token=${accessToken}&count=8`\n  user.fullname = profile._json.data.fullname;\n  done(null, user)\n}))\n\napp.get('/auth/instagram', passport.authenticate('instagram'))\n\napp.get('/auth', passport.authenticate('instagram', {\n  successRedirect: '/users',\n  failure: '/'\n}))\n\napp.get('/users', (req, res) => {\n  res.status(200)\n    .json({ 'user': req.user })\n})\n\n\napp.use(function (req, res, next) {\n  next(createError(404));\n});\n\n\n\n// error handler\napp.use(function (err, req, res, next) {\n  // set locals, only providing error in development\n  res.locals.message = err.message;\n  res.locals.error = req.app.get('env') === 'development' ? err : {};\n\n  // render the error page\n  res.status(err.status || 500);\n  res.render('error');\n});\nmodule.exports = app;\n"],"file":"app.js"}